<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aguapanela Dulce Imaginaci√≥n - E-SHOP</title>
    
    <!-- FAVICON (Tacita Rosa Fondo Caf√©) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' fill='%235a3e2b' rx='10'/><path d='M14 22h28c0 10 5 20 14 20s14-10 14-20' fill='none'/><path d='M18 22h28v16c0 7.7-6.3 14-14 14s-14-6.3-14-14V22z' fill='%23ffc0cb'/><path d='M46 24h8c2.2 0 4 1.8 4 4v8c0 2.2-1.8 4-4 4h-8' fill='none' stroke='%23ffc0cb' stroke-width='5'/><path d='M22 16q4-6 8 0t8 0' fill='none' stroke='white' stroke-width='2' opacity='0.5'/></svg>" type="image/svg+xml">

    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Iconos Vectoriales -->
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@2.1.0/dist/iconify-icon.min.js"></script>

    <style>
        /* --- ESTILOS BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: #f8f5f2; color: #5a3e2b; line-height: 1.6; }
        
        /* PROTECCI√ìN DE IM√ÅGENES */
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-select: none;
            -webkit-touch-callout: none; 
        }

        /* Contenedor principal */
        .poster-container {
            width: 100%;
            max-width: 720px;
            min-height: 100vh;
            margin: 0 auto;
            background: linear-gradient(135deg, #f8f5f2 0%, #e8dfd5 100%);
            position: relative;
            overflow-x: hidden;
            box-shadow: 0 10px 30px rgba(90, 62, 43, 0.1);
            padding-bottom: 60px;
        }
        
        /* Header */
        .header {
            padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon {
            width: 45px; height: 45px; background-color: #c97e58; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white;
        }
        .logo-text { font-size: 15px; font-weight: 700; color: #5a3e2b; font-family: 'Quicksand', sans-serif; line-height: 1.2; }
        .logo-text span { display: block; font-size: 10px; font-weight: 600; color: #c97e58; letter-spacing: 1px; margin-top: 2px;}
        
        /* Carrito Icono */
        .cart-trigger { position: relative; cursor: pointer; color: #5a3e2b; margin-right: 5px; }
        .cart-count {
            position: absolute; top: -5px; right: -8px;
            background-color: #c97e58; color: white;
            font-size: 10px; width: 18px; height: 18px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold;
        }

        /* Hero Section */
        .hero { padding: 30px 20px; text-align: center; }
        .hero-title { font-size: 28px; font-weight: 700; margin-bottom: 10px; color: #5a3e2b; font-family: 'Quicksand', sans-serif; }
        .hero-subtitle { font-size: 14px; color: #8b6f47; margin-bottom: 20px; max-width: 500px; margin-left: auto; margin-right: auto;}
        .cta-button {
            background-color: #c97e58; color: white; border: none; padding: 10px 25px;
            border-radius: 30px; font-size: 14px; font-weight: 500; cursor: pointer;
            box-shadow: 0 4px 15px rgba(201, 126, 88, 0.3); text-decoration: none; display: inline-block;
        }

        /* Categor√≠as */
        .categories { padding: 0 0 20px 0; }
        .section-title {
            font-size: 18px; font-weight: 600; margin: 20px 20px 10px;
            color: #5a3e2b; font-family: 'Quicksand', sans-serif;
            display: flex; align-items: center; gap: 8px;
        }
        .category-cards {
            display: flex; gap: 10px; padding: 0 20px; overflow-x: auto; padding-bottom: 10px;
            scrollbar-width: none;
        }
        .category-card {
            min-width: 90px; background-color: white; border-radius: 12px;
            padding: 12px 8px; text-align: center;
            box-shadow: 0 2px 8px rgba(90, 62, 43, 0.05);
            cursor: pointer; transition: all 0.2s; border: 1px solid transparent;
        }
        .category-card.active { background-color: #f0e6dc; border-color: #c97e58; }
        .category-icon { font-size: 24px; margin-bottom: 5px; color: #c97e58; }
        .category-name { font-size: 11px; font-weight: 600; color: #5a3e2b; }

        /* Productos */
        .products { padding: 0 20px 20px; min-height: 400px;}
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .product-card {
            background-color: white; border-radius: 16px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(90, 62, 43, 0.05);
            display: flex; flex-direction: column;
        }
        
        .product-image-wrapper {
            position: relative; height: 170px; overflow: hidden; background: #f4f4f4; cursor: zoom-in;
        }
        .product-img {
            width: 100%; height: 100%; object-fit: cover;
            position: absolute; top: 0; left: 0;
            transition: opacity 0.8s ease-in-out;
        }
        .product-img.hidden { opacity: 0; }
        .img-placeholder {
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
            background: #eee; color: #aaa; font-size: 10px; text-align: center; padding: 10px;
        }
        
        .product-info { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-cat { font-size: 9px; text-transform: uppercase; color: #8b6f47; letter-spacing: 1px; margin-bottom: 4px;}
        .product-name { font-size: 13px; font-weight: 700; color: #5a3e2b; line-height: 1.3; margin-bottom: 5px; height: 34px; overflow: hidden;}
        .product-price { font-size: 15px; font-weight: 700; color: #c97e58; margin-bottom: 8px; }
        
        .size-select {
            width: 100%; padding: 5px; margin-bottom: 10px;
            border: 1px solid #ddd; border-radius: 6px;
            font-size: 11px; color: #5a3e2b; background-color: #fff;
        }
        
        .btn-row { display: flex; gap: 5px; margin-top: auto; }
        .add-btn {
            flex: 1; background-color: #5a3e2b; color: white; border: none;
            padding: 8px 0; border-radius: 8px; font-size: 10px; cursor: pointer; font-weight: 500;
        }
        /* Botones peque√±os (Chat y Share) */
        .icon-btn {
            width: 32px; height: 32px; border: none;
            border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .whatsapp-btn { background-color: #25D366; color: white; }
        .share-btn { background-color: #f0e6dc; color: #5a3e2b; }
        .share-btn:hover { background-color: #c97e58; color: white; }

        /* Features */
        .features {
            background-color: white; margin: 20px 20px; padding: 25px 10px;
            border-radius: 16px; box-shadow: 0 4px 20px rgba(90, 62, 43, 0.05);
            display: flex; justify-content: space-around; align-items: flex-start;
            flex-wrap: wrap; gap: 15px;
        }
        .feature-item {
            display: flex; flex-direction: column; align-items: center; 
            text-align: center; flex: 1; min-width: 80px;
        }
        .feature-icon-circle {
            width: 45px; height: 45px; background-color: #f0e6dc; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: #c97e58; margin-bottom: 10px;
        }
        .feature-content h4 { font-size: 11px; font-weight: 700; color: #5a3e2b; margin: 0; line-height: 1.2;}
        .feature-content p { font-size: 10px; color: #8b6f47; margin: 3px 0 0 0; line-height: 1.2;}

        /* Footer */
        .footer {
            background-color: rgba(255,255,255,0.8); padding: 30px 20px; text-align: center; margin-top: 20px;
        }
        .social-icons { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .social-icon {
            width: 40px; height: 40px; background-color: #5a3e2b; color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; text-decoration: none; transition: all 0.2s;
        }
        .social-icon:hover { transform: translateY(-3px); background-color: #c97e58;}
        .social-icon.wa-footer { background-color: #25D366; }
        .social-icon.wa-footer:hover { background-color: #128C7E; }
        .copyright { font-size: 10px; color: #8b6f47; border-top: 1px solid #e0e0e0; padding-top: 15px; }

        /* OVERLAY GENERAL */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 999; display: none;
        }
        .overlay.active { display: block; }

        /* MODAL CARRITO */
        .cart-modal {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100vh;
            background-color: white; z-index: 1000; transition: right 0.3s ease;
            box-shadow: -5px 0 30px rgba(0,0,0,0.2); display: flex; flex-direction: column;
        }
        .cart-modal.open { right: 0; }
        .cart-header { padding: 20px; background-color: #5a3e2b; color: white; display: flex; justify-content: space-between; align-items: center; }
        .cart-items { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .cart-item img { width: 50px; height: 50px; border-radius: 6px; object-fit: cover; }
        .item-info { flex-grow: 1; }
        .item-name { font-size: 13px; font-weight: 600; line-height: 1.2; }
        .item-variant { font-size: 11px; color: #888; display: block; }
        .item-price { font-size: 12px; color: #c97e58; font-weight: 700; }
        .item-controls { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
        .qty-btn { width: 20px; height: 20px; background: #eee; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .cart-footer { padding: 20px; background-color: #f9f9f9; border-top: 1px solid #eee; }
        .summary-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px; }
        .total-row { font-weight: 700; font-size: 16px; color: #5a3e2b; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px; }
        .checkout-btn {
            width: 100%; background-color: #25D366; color: white; border: none; padding: 15px;
            border-radius: 30px; font-size: 16px; font-weight: 600; margin-top: 15px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .free-shipping-alert {
            background-color: #e3f2fd; color: #1565c0; font-size: 11px; padding: 8px;
            border-radius: 6px; margin-bottom: 10px; text-align: center;
        }
        .free-shipping-alert.success { background-color: #e8f5e9; color: #2e7d32; }

        /* LIGHTBOX */
        .lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .lightbox.active { display: flex; opacity: 1; }
        .lightbox-content { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .lightbox-img { max-height: 85vh; max-width: 90vw; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); transition: transform 0.3s ease; cursor: zoom-in; object-fit: contain; }
        .lightbox-img.zoomed { transform: scale(2); cursor: zoom-out; }
        .close-lightbox {
            position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer;
            z-index: 2001; background: rgba(0,0,0,0.3); width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- POPUP DE COMPARTIR --- */
        .share-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; width: 90%; max-width: 320px;
            border-radius: 16px; padding: 25px; z-index: 2100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center; display: none;
        }
        .share-modal.active { display: block; animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: translate(-50%, -40%); opacity: 0; } to { transform: translate(-50%, -50%); opacity: 1; } }
        
        .share-title { font-size: 18px; font-weight: 700; color: #5a3e2b; margin-bottom: 20px; }
        .share-options { display: flex; flex-direction: column; gap: 10px; }
        .share-btn-option {
            display: flex; align-items: center; gap: 10px;
            padding: 12px; border-radius: 10px; text-decoration: none;
            font-weight: 600; font-size: 14px; transition: transform 0.2s; border: none; width: 100%; cursor: pointer;
        }
        .share-btn-option:hover { transform: translateY(-2px); }
        
        .share-wa { background-color: #E0F8E8; color: #128C7E; }
        .share-fb { background-color: #E7F0FF; color: #1877F2; }
        .share-copy { background-color: #f4f4f4; color: #5a3e2b; justify-content: center;}
        
        .close-share {
            margin-top: 15px; color: #888; font-size: 12px; cursor: pointer; text-decoration: underline;
        }

    </style>
</head>
<body>

<div class="poster-container">
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon"><i class="material-icons">local_cafe</i></div>
            <div class="logo-text">Aguapanela Dulce Imaginaci√≥n<br><span>E-SHOP</span></div>
        </div>
        <div class="cart-trigger" onclick="toggleCart()">
            <i class="material-icons" style="font-size: 28px;">shopping_cart</i>
            <div class="cart-count" id="cartCount">0</div>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <h1 class="hero-title">Dise√±os √önicos y Creativos</h1>
        <p class="hero-subtitle">Libretas, tote bags y amigurumis hechos con amor por Aguapanela Dulce Imaginaci√≥n.</p>
        <a href="#catalogo" class="cta-button">Ver Cat√°logo</a>
    </section>

    <!-- Categor√≠as -->
    <section class="categories">
        <div class="section-title"><i class="material-icons">category</i> Categor√≠as</div>
        <div class="category-cards">
            <div class="category-card active" onclick="filterProducts('Todo', this)">
                <i class="material-icons category-icon">grid_view</i>
                <div class="category-name">Todo</div>
            </div>
            <div class="category-card" onclick="filterProducts('Tote Bags', this)">
                <i class="material-icons category-icon">shopping_bag</i>
                <div class="category-name">Tote Bags</div>
            </div>
            <div class="category-card" onclick="filterProducts('Amigurumis', this)">
                <i class="material-icons category-icon">toys</i>
                <div class="category-name">Amigurumis</div>
            </div>
            <div class="category-card" onclick="filterProducts('Libretas', this)">
                <i class="material-icons category-icon">book</i>
                <div class="category-name">Libretas</div>
            </div>
        </div>
    </section>

    <!-- Cat√°logo -->
    <section class="products" id="catalogo">
        <div id="productContainer" class="product-grid">
            <!-- JS llena esto -->
        </div>
    </section>

    <!-- Features -->
    <section class="features">
        <div class="feature-item">
            <div class="feature-icon-circle"><i class="material-icons">local_shipping</i></div>
            <div class="feature-content">
                <h4>Env√≠o Gratis</h4>
                <p>Por compras mayores a $120.000 cop</p>
            </div>
        </div>
        <div class="feature-item">
            <div class="feature-icon-circle"><i class="material-icons">autorenew</i></div>
            <div class="feature-content">
                <h4>Devoluciones</h4>
                <p>Hasta 7 d√≠as</p>
            </div>
        </div>
        <div class="feature-item">
            <div class="feature-icon-circle"><i class="material-icons">eco</i></div>
            <div class="feature-content">
                <h4>Sostenible</h4>
                <p>Calidad premium</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="social-icons">
            <a href="https://www.facebook.com/AguapanelaDulceImaginacion" target="_blank" class="social-icon">
                <i class="material-icons">facebook</i>
            </a>
            <a href="https://instagram.com/aguapaneladulceimaginacion" target="_blank" class="social-icon">
                <iconify-icon icon="mdi:instagram" width="24" height="24" style="color: white;"></iconify-icon>
            </a>
            <a href="https://wa.me/573122665870" target="_blank" class="social-icon wa-footer">
                <iconify-icon icon="ic:baseline-whatsapp" width="24" height="24" style="color: white;"></iconify-icon>
            </a>
            <a href="mailto:dulceimaginacion.startup@gmail.com" class="social-icon">
                <i class="material-icons">alternate_email</i>
            </a>
        </div>
        <div class="copyright">¬© 2025-2026 Aguapanela Dulce Imaginaci√≥n. Todos los derechos reservados.</div>
    </footer>
</div>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" onclick="closeLightbox(event)">
    <div class="close-lightbox" onclick="closeLightbox(event)">&times;</div>
    <div class="lightbox-content">
        <img id="lightbox-img" class="lightbox-img" src="" onclick="toggleZoom(event)">
    </div>
</div>

<!-- MODAL DE COMPARTIR -->
<div class="share-modal" id="shareModal">
    <div class="share-title">Compartir Producto</div>
    <div class="share-options">
        <button class="share-btn-option share-wa" onclick="shareAction('wa')">
            <iconify-icon icon="ic:baseline-whatsapp" width="20"></iconify-icon> Enviar por WhatsApp
        </button>
        <button class="share-btn-option share-fb" onclick="shareAction('fb')">
            <iconify-icon icon="ic:baseline-facebook" width="20"></iconify-icon> Compartir en Facebook
        </button>
        <button class="share-btn-option share-copy" onclick="shareAction('copy')">
            <i class="material-icons" style="font-size:18px">content_copy</i> Copiar enlace
        </button>
    </div>
    <div class="close-share" onclick="closeShareModal()">Cancelar</div>
</div>

<!-- CARRITO OVERLAY -->
<div class="overlay" id="overlay" onclick="closeAllModals()"></div>
<div class="cart-modal" id="cartModal">
    <div class="cart-header">
        <h3>Tu Carrito</h3>
        <i class="material-icons" style="cursor:pointer" onclick="toggleCart()">close</i>
    </div>
    <div class="cart-items" id="cartItemsContainer"></div>
    <div class="cart-footer">
        <div id="shippingAlert" class="free-shipping-alert"></div>
        <div class="summary-row"><span>Subtotal</span><span id="subtotalPrice">$0</span></div>
        <div class="summary-row"><span>Env√≠o</span><span id="shippingPrice">$0</span></div>
        <div class="total-row"><span style="flex-grow:1">Total</span><span id="totalPrice">$0</span></div>
        <button class="checkout-btn" onclick="checkoutWhatsApp()">
            <iconify-icon icon="ic:baseline-whatsapp" width="24" height="24"></iconify-icon> Completar Pedido
        </button>
    </div>
</div>

<script>
    const CONFIG = {
        phone: "573122665870",
        shippingCost: 15000,
        freeShippingThreshold: 120000
    };

    const totePrices = [
        { name: "Mini (20x22cm)", price: 20000 },
        { name: "Peque√±o (26x33cm)", price: 26000 },
        { name: "Mediano (31x36cm)", price: 32000 },
        { name: "Grande (35x42cm)", price: 36000 },
        { name: "Grandote (38x45cm)", price: 42000 }
    ];

    const products = [
        { id: 101, name: "Amigurumi Capybara", category: "Amigurumis", price: 22000, images: ["img/ami_capi.png"] },
        { id: 102, name: "Cerezas Tejidas", category: "Amigurumis", price: 18000, images: ["img/ami_cerezas.png"] },
        { id: 103, name: "Amigurumi Ping√ºino", category: "Amigurumis", price: 22000, images: ["img/ami_pingu.png"] },
        { id: 201, name: "Libreta Cali Mir√° Ve", category: "Libretas", price: 12000, images: ["img/libreta_cali.png"] },
        { id: 301, name: "Tote Bag Capybara Faces", category: "Tote Bags", variable: true, images: ["img/tote_capi_faces_1.png", "img/tote_capi_faces_2.png"] },
        { id: 302, name: "Tote Bag Capybara Flowers", category: "Tote Bags", variable: true, images: ["img/tote_capi_flower_1.png", "img/tote_capi_flower_2.png"] },
        { id: 303, name: "Tote Bag Harry Potter", category: "Tote Bags", variable: true, images: ["img/tote_harry_1.png", "img/tote_harry_2.png"] },
        { id: 304, name: "Tote Bag Mariposas", category: "Tote Bags", variable: true, images: ["img/tote_mariposa_1.png", "img/tote_mariposa_2.png"] },
        { id: 305, name: "Tote Bag El Principito", category: "Tote Bags", variable: true, images: ["img/tote_principito_1.png", "img/tote_principito_2.png"] },
        { id: 306, name: "Tote Bag Van Gogh", category: "Tote Bags", variable: true, images: ["img/tote_vangogh_1.png", "img/tote_vangogh_2.png"] },
        { id: 307, name: "Tote Bag Totoro", category: "Tote Bags", variable: true, images: ["img/tote_totoro.png"] },
        { id: 308, name: "Tote Bag David", category: "Tote Bags", variable: true, images: ["img/tote_david.png"] },
        { id: 309, name: "Tote Bag BMO", category: "Tote Bags", variable: true, images: ["img/tote_bmo.png"] },
        { id: 310, name: "Tote Bag Mafalda Bow", category: "Tote Bags", variable: true, images: ["img/tote_mafalda_bow.png"] },
        { id: 311, name: "Tote Bag Mafalda Vivos", category: "Tote Bags", variable: true, images: ["img/tote_mafalda_vivos.png"] },
        { id: 312, name: "Tote Bag Capybara Mago", category: "Tote Bags", variable: true, images: ["img/tote_capi_mago.png"] },
        { id: 313, name: "Tote Bag Chihiro", category: "Tote Bags", variable: true, images: ["img/tote_chihiro.png"] }
    ];

    let cart = [];
    let currentShareProduct = null; // Para saber qu√© producto se comparte

    function init() {
        renderProducts('Todo');
        startImageSlideshow();
        // Bloqueo click derecho
        document.addEventListener('contextmenu', e => {
            if (e.target.tagName === 'IMG' || e.target.classList.contains('lightbox-img')) e.preventDefault();
        });
    }

    function filterProducts(category, element) {
        document.querySelectorAll('.category-card').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        renderProducts(category);
    }

    function renderProducts(category) {
        const container = document.getElementById('productContainer');
        container.innerHTML = '';
        const filtered = category === 'Todo' ? products : products.filter(p => p.category === category);

        if(filtered.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color:#999;">No hay productos en esta categor√≠a.</div>';
            return;
        }

        filtered.forEach(p => {
            let imagesHtml = p.images.map((src, i) => 
                `<img src="${src}" class="product-img ${i === 0 ? '' : 'hidden'}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" onclick="openLightbox('${src}')">
                 <div class="img-placeholder" style="display:none">Foto no encontrada<br>${src}</div>`
            ).join('');

            let priceHtml = p.variable 
                ? `<div class="product-price" id="price-display-${p.id}">Desde $${formatPrice(totePrices[0].price)}</div>`
                : `<div class="product-price">$${formatPrice(p.price)}</div>`;
                
            let controlHtml = p.variable 
                ? `<select class="size-select" id="size-${p.id}" onchange="updatePriceDisplay(${p.id})">
                    ${totePrices.map((tp, idx) => `<option value="${idx}">${tp.name} - $${formatPrice(tp.price)}</option>`).join('')}
                   </select>` 
                : '';

            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="product-image-wrapper" id="slider-${p.id}">${imagesHtml}</div>
                <div class="product-info">
                    <div class="product-cat">${p.category}</div>
                    <div class="product-name">${p.name}</div>
                    ${priceHtml}
                    ${controlHtml}
                    <div class="btn-row">
                        <button class="add-btn" onclick="addToCart(${p.id})">AGREGAR</button>
                        <button class="icon-btn whatsapp-btn" onclick="askProduct(${p.id})"><iconify-icon icon="ic:baseline-whatsapp" width="18"></iconify-icon></button>
                        <button class="icon-btn share-btn" onclick="openShareModal(${p.id})"><i class="material-icons" style="font-size:18px">share</i></button>
                    </div>
                </div>`;
            container.appendChild(card);
        });
    }

    function updatePriceDisplay(id) {
        const select = document.getElementById(`size-${id}`);
        const priceDisplay = document.getElementById(`price-display-${id}`);
        priceDisplay.innerText = `$${formatPrice(totePrices[select.value].price)}`;
    }

    function addToCart(id) {
        const product = products.find(p => p.id === id);
        let itemToAdd = { ...product };
        if (product.variable) {
            const select = document.getElementById(`size-${id}`);
            const variant = totePrices[select.value];
            itemToAdd.uniqueId = `${id}-${select.value}`;
            itemToAdd.price = variant.price;
            itemToAdd.variantName = variant.name;
        } else {
            itemToAdd.uniqueId = `${id}-default`;
            itemToAdd.variantName = "";
        }
        const existing = cart.find(i => i.uniqueId === itemToAdd.uniqueId);
        existing ? existing.qty++ : (itemToAdd.qty = 1, cart.push(itemToAdd));
        updateCartUI();
        toggleCart();
    }

    function updateCartUI() {
        const totalQty = cart.reduce((sum, i) => sum + i.qty, 0);
        document.getElementById('cartCount').innerText = totalQty;
        
        const container = document.getElementById('cartItemsContainer');
        if (cart.length === 0) {
            container.innerHTML = '<div style="text-align:center; padding:40px; color:#aaa"><i class="material-icons" style="font-size:40px">shopping_basket</i><br>Carrito vac√≠o</div>';
        } else {
            container.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <img src="${item.images[0]}" onerror="this.src='https://placehold.co/50'">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        ${item.variantName ? `<span class="item-variant">${item.variantName}</span>` : ''}
                        <div class="item-price">$${formatPrice(item.price * item.qty)}</div>
                    </div>
                    <div class="item-controls">
                        <button class="qty-btn" onclick="changeQty('${item.uniqueId}', -1)">-</button>
                        <span style="font-size:12px; font-weight:bold">${item.qty}</span>
                        <button class="qty-btn" onclick="changeQty('${item.uniqueId}', 1)">+</button>
                    </div>
                </div>`).join('');
        }

        const subtotal = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
        let shipping = subtotal >= CONFIG.freeShippingThreshold ? 0 : CONFIG.shippingCost;
        if (cart.length === 0) shipping = 0;

        const alertEl = document.getElementById('shippingAlert');
        if (subtotal >= CONFIG.freeShippingThreshold) {
            alertEl.innerText = "¬°Genial! Tienes ENV√çO GRATIS üéâ";
            alertEl.classList.add('success');
        } else {
            alertEl.innerText = `Agrega $${formatPrice(CONFIG.freeShippingThreshold - subtotal)} m√°s para Env√≠o GRATIS`;
            alertEl.classList.remove('success');
        }

        document.getElementById('subtotalPrice').innerText = `$${formatPrice(subtotal)}`;
        document.getElementById('shippingPrice').innerText = shipping === 0 ? "GRATIS" : `$${formatPrice(shipping)}`;
        document.getElementById('totalPrice').innerText = `$${formatPrice(subtotal + shipping)}`;
    }

    function changeQty(uniqueId, delta) {
        const idx = cart.findIndex(i => i.uniqueId === uniqueId);
        if (idx === -1) return;
        cart[idx].qty += delta;
        if (cart[idx].qty <= 0) cart.splice(idx, 1);
        updateCartUI();
    }

    function checkoutWhatsApp() {
        if (cart.length === 0) return alert("El carrito est√° vac√≠o");
        let msg = "Hola ADI! üëã Me gustar√≠a pedir lo siguiente:\n\n";
        cart.forEach(i => msg += `- ${i.name} ${i.variantName ? `(${i.variantName})` : ''} x${i.qty} - $${formatPrice(i.price * i.qty)}\n`);
        const subtotal = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
        const shipping = subtotal >= CONFIG.freeShippingThreshold ? 0 : CONFIG.shippingCost;
        msg += `\nSubtotal: $${formatPrice(subtotal)}`;
        msg += `\nEnv√≠o: ${shipping === 0 ? "GRATIS üéâ" : "$" + formatPrice(shipping)}`;
        msg += `\n*TOTAL: $${formatPrice(subtotal + shipping)}*`;
        msg += `\n\nQuedo pendiente para el pago. ¬°Gracias!`;
        window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function askProduct(id) {
        const p = products.find(i => i.id === id);
        window.open(`https://wa.me/${CONFIG.phone}?text=${encodeURIComponent("Hola! Me interesa saber m√°s sobre: " + p.name)}`, '_blank');
    }

    // --- L√ìGICA COMPARTIR ---
    function openShareModal(id) {
        currentShareProduct = products.find(p => p.id === id);
        document.getElementById('shareModal').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }

    function closeShareModal() {
        document.getElementById('shareModal').classList.remove('active');
        if(!document.getElementById('cartModal').classList.contains('open')) {
            document.getElementById('overlay').classList.remove('active');
        }
    }

    function shareAction(type) {
        if (!currentShareProduct) return;
        const url = window.location.href;
        const text = `¬°Mira este hermoso dise√±o de ADI! ${currentShareProduct.name} - Desde $${formatPrice(currentShareProduct.price)}. Visita: `;
        
        if (type === 'wa') {
            window.open(`https://wa.me/?text=${encodeURIComponent(text + url)}`, '_blank');
        } else if (type === 'fb') {
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        } else if (type === 'copy') {
            navigator.clipboard.writeText(text + url).then(() => {
                alert('¬°Enlace y mensaje copiados! P√©galos en Instagram o donde quieras.');
            });
        }
        closeShareModal();
    }

    // --- UTILS ---
    function formatPrice(num) { return num.toLocaleString('es-CO'); }
    
    function toggleCart() {
        document.getElementById('cartModal').classList.toggle('open');
        const overlay = document.getElementById('overlay');
        // Solo toggles si el share no est√° abierto
        if (!document.getElementById('shareModal').classList.contains('active')) {
            overlay.classList.toggle('active');
        }
    }

    function closeAllModals() {
        document.getElementById('cartModal').classList.remove('open');
        document.getElementById('shareModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
    }

    // --- LIGHTBOX ---
    function openLightbox(src) {
        const lb = document.getElementById('lightbox');
        const img = document.getElementById('lightbox-img');
        img.src = src;
        img.classList.remove('zoomed');
        lb.classList.add('active');
    }
    function closeLightbox(e) {
        if (e.target.id === 'lightbox' || e.target.classList.contains('close-lightbox')) {
            document.getElementById('lightbox').classList.remove('active');
        }
    }
    function toggleZoom(e) {
        e.stopPropagation();
        document.getElementById('lightbox-img').classList.toggle('zoomed');
    }

    // --- SLIDER AUTOM√ÅTICO ---
    function startImageSlideshow() {
        setInterval(() => {
            products.forEach(p => {
                if (p.images.length > 1) {
                    const wrapper = document.getElementById(`slider-${p.id}`);
                    if (!wrapper) return;
                    const imgs = wrapper.querySelectorAll('img.product-img');
                    if(imgs.length === 0) return;
                    let visibleIdx = -1;
                    imgs.forEach((img, idx) => {
                        if (!img.classList.contains('hidden')) visibleIdx = idx;
                        img.classList.add('hidden');
                    });
                    let nextIdx = (visibleIdx + 1) % imgs.length;
                    imgs[nextIdx].classList.remove('hidden');
                }
            });
        }, 3000);
    }

    init();
</script>
</body>
</html>
